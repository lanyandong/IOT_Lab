### ZigBee 入门开发

**基本流程**

1. 熟悉基于 STM32W108 处理器的ZigBee硬件解决方案。
2. 安装配置 ZigBee2007PRO 协议栈 EmberZnet的相关开发环境。
3. 使用 IAR 软件打开工程，配置PANID 以及修改硬件资源文件。
4. 调试编译工程，无错后烧写程序。



**基本配置**

后面的几次实验都是基于上面的流程，更多的是进行相应的配置，和对各个功能模块的学习和理解。我们也主要关注 sink.sww 和sensor.sww 两个工程。

为了避免网络冲突，需要修改common.h 文件，找到#define APP_PANID(0x01ff)，修改APP_PANID() 里面的值。

为了能够进行组网，需要修改board.c 源文件里的ButtonsMB851A[] 与 LedsMB851A[] 代码的端口配置。

烧写程序，使用JLINK连接实验平台，将指示灯调到对应模块，进行烧写。sensor 模块和协调器sink模块需要分别烧写。

串口调试工具：需要进行波特率和端口的配置，用于PC与ZigBee模块通信，具体情况具体分析。



**ZigBee组网**

点对点传感网：一个数据收集节点（sensor）和一个数据存储的节点（sink）。一个sink和一个sensor之间组成通信网络。

分布式传感网：一个或者多个数据收集节点（sensor），和一个数据存储的节点（sink）。一个sink 和三个sensor之间组成星形网络。

分别给模块烧写相应程序，然后通过rest协调器模块，sensor模块分别加入组网，要重复尝试几次才能组网成功。可以通过串口调试工具来监测是否组网成功（有相应的信息输出到串口）。



 **PC机串口控制ZigBee实验**

这次实验最核心的东西是如何使用PC 通过串口对ZigBee模块进行控制，简单来说就是通过串口给ZigBee协调器模块发送指令消息，ZigBee协调器模块程序根据收的消息指令并将指令转发给各节点执行相应的功能。

这个实验中就是通过发送指令消息来分别调用void sendOnLedtoSensor(void)函数和void sendOffLedtoSensor(void)函数来实现sink节点控制sensor节点的LED灯的状态的。

实验主要还是基于前面的ZigBee基本配置，ZigBee组网，以及串口调试来进行操作的。



**基于ZigBee的无线传感器网络实验**

Sensor节点收集传感器数据，通过ZigBee无线网络发送到sink节点。Sink节点接收Sensor节点发来的数据，并通过串口输出到PC机。

在ZigBee模块上加上传感器，就可以进行数据采集，并通过ZigBee网络进行数据传输，通过串口发送到PC机，用户可以根据数据协议对采集到的数据进行处理，这里主要测试了温湿度传感器和光照传感器的数据的采集。



**总结**

通过几次实验大致了解了ZigBee入门开发，因为使用的是协议栈，很多功能已经封装好了并且不支持用户修改，所以很少写代码，大多数情况是进行配置，有时候可能会因为硬件本身原因导致实验失败，这是很难避免的。其实大多数与硬件相关的开发，也都需要花费很多时间了解硬件资源和进行相关配置，这很多时候只是一种技术实施细节而已，但对于开发这是一个不能跳过的关键步骤。